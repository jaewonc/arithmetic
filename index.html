<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arithmetic Practice</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: url('background.jpg') no-repeat center center;
            background-size: cover;
            filter: blur(2px);
            z-index: -1;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 40px 100px rgba(0,0,0,0.7);
            max-width: 600px;
            width: 100%;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 2em; margin-bottom: 5px; }
        
        .content { padding: 40px; }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #f5576c;
        }
        
        .stat-label {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }
        
        .problem-display {
            background: #f7fafc;
            padding: 40px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 48px;
            font-weight: bold;
            color: #2d3748;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .vertical-problem {
            font-family: 'Courier New', monospace;
            line-height: 1.2;
            white-space: pre;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 16px;
            font-size: 24px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            transition: all 0.3s;
            background: white;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #f5576c;
            box-shadow: 0 0 0 3px rgba(245, 87, 108, 0.1);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            flex: 1;
            padding: 14px 20px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #f5576c;
            color: white;
        }
        
        .btn-primary:hover {
            background: #e04858;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.4);
        }
        
        .btn-secondary {
            background: #cbd5e0;
            color: #2d3748;
        }
        
        .btn-secondary:hover { background: #a0aec0; }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #cbd5e0;
        }
        
        button:disabled:hover {
            transform: none;
            box-shadow: none;
            background: #cbd5e0;
        }
        
        input[type="text"]:disabled {
            background: #f7fafc;
            color: #a0aec0;
            cursor: not-allowed;
        }
        
        .option-group {
            margin: 20px 0;
            text-align: left;
        }
        
        .option-group h3 {
            margin-bottom: 12px;
            color: #2d3748;
            font-size: 16px;
        }
        
        .option-group label {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin: 4px 0;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            color: #2d3748;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-group label:hover { background: #f7fafc; }
        
        .option-group input[type="radio"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e0;
            border-radius: 50%;
            margin-right: 12px;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        
        .option-group input[type="radio"]:checked {
            border-color: #f5576c;
            background: #f5576c;
        }
        
        .option-group input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f5576c;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f5576c;
            cursor: pointer;
            border: none;
        }
        
        .hidden { display: none; }
        
        .results-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .result-item {
            background: #fff5f5;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #fc8181;
            font-size: 18px;
        }
        
        .result-item strong { color: #742a2a; }
        .result-item .user-answer {
            color: #e53e3e;
            font-style: italic;
        }
        
        .perfect {
            background: #c6f6d5;
            color: #22543d;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
        }
        
        .history-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
        }
        
        .history-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .graph {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .line-chart {
            position: relative;
            height: 180px;
            margin-top: 20px;
        }
        
        .chart-svg {
            width: 100%;
            height: 150px;
        }
        
        .chart-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 11px;
            color: #718096;
        }
        
        .footer {
            text-align: center;
            color: #718096;
            font-size: 14px;
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¢ Arithmetic Practice</h1>
            <p>Master your math skills</p>
        </div>
        
        <div class="content">
            <div id="setup">
                <div class="option-group">
                    <h3>Operation:</h3>
                    <label><input type="radio" name="operation" value="+" checked onchange="updateDifficulties()"><span>Addition (+)</span></label>
                    <label><input type="radio" name="operation" value="-" onchange="updateDifficulties()"><span>Subtraction (‚àí)</span></label>
                    <label><input type="radio" name="operation" value="*" onchange="updateDifficulties()"><span>Multiplication (√ó)</span></label>
                    <label><input type="radio" name="operation" value="/" onchange="updateDifficulties()"><span>Division (√∑)</span></label>
                    <label><input type="radio" name="operation" value="mixed" onchange="updateDifficulties()"><span>Mixed Operations</span></label>
                </div>
                
                <div class="option-group">
                    <h3>Difficulty:</h3>
                    <div id="difficultyLabel" style="background: #f7fafc; padding: 12px; border-radius: 8px; margin-bottom: 12px; color: #2d3748; font-size: 15px;"></div>
                    <input type="range" id="difficultySlider" min="0" max="4" value="0" oninput="updateDifficultyLabel()" style="width: 100%; height: 6px; border-radius: 3px; background: #e2e8f0; outline: none; -webkit-appearance: none;">
                </div>
                
                <button class="btn-primary" onclick="startPractice()" style="width: 100%;">Start Practice</button>
            </div>

            <div id="practice" class="hidden">
                <div class="stats-bar">
                    <div class="stat-card">
                        <div class="stat-value" id="totalStat">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="correctStat">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="wrongStat">0</div>
                        <div class="stat-label">Wrong</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="accuracyStat">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                </div>
                
                <div class="problem-display" id="problemDisplay"></div>
                
                <input type="text" id="userInput" placeholder="?" onkeypress="handleEnter(event)" autocomplete="off">
                
                <div class="btn-group">
                    <button class="btn-primary" id="submitBtn" onclick="checkAnswer()">Submit</button>
                    <button class="btn-secondary" onclick="stopPractice()">Stop</button>
                </div>
            </div>

            <div id="results" class="hidden">
                <h2 style="margin-bottom: 20px;">üìä Results</h2>
                
                <div class="stats-bar">
                    <div class="stat-card">
                        <div class="stat-value" id="finalTotal">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="finalCorrect">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="finalWrong">0</div>
                        <div class="stat-label">Wrong</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="finalAccuracy">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                </div>
                
                <h3 style="margin: 20px 0 10px 0;">Review Mistakes</h3>
                <div id="wrongAnswers" class="results-list"></div>
                
                <div id="historyStats"></div>
                
                <button class="btn-primary" onclick="restart()" style="width: 100%; margin-top: 20px;">New Practice</button>
            </div>
            
            <div class="footer">
                ¬© 2025 Jaewon Choi (<a href="mailto:cmdrkeen@gmail.com" style="color: #f5576c; text-decoration: none;">cmdrkeen@gmail.com</a>)
            </div>
        </div>
    </div>

    <script>
        let operation = '+';
        let difficulty = '1digit';
        let currentProblem = null;
        let correct = 0;
        let total = 0;
        let wrongList = [];
        let sessionHistory = [];

        function loadHistory() {
            try {
                const saved = localStorage.getItem('arithmeticHistory');
                if (saved) sessionHistory = JSON.parse(saved);
            } catch (e) {
                sessionHistory = [];
            }
        }

        function saveSession() {
            const session = {
                date: new Date().toISOString(),
                operation: operation,
                difficulty: difficulty,
                total: total,
                correct: correct,
                wrong: total - correct,
                accuracy: total > 0 ? Math.round((correct / total) * 100) : 0
            };
            sessionHistory.push(session);
            try {
                localStorage.setItem('arithmeticHistory', JSON.stringify(sessionHistory));
            } catch (e) {
                console.warn('Failed to save history:', e);
            }
        }

        const difficulties = {
            '+': [
                { value: '1digit', label: '1 digit (e.g., 3 + 5)', gen: () => Math.floor(Math.random() * 9) + 1 },
                { value: '2digit-simple', label: '2 digits - no carry (e.g., 12 + 23)', gen: (first) => {
                    if (first === undefined) {
                        return Math.floor(Math.random() * 80) + 10; // 10-89 to ensure room for second number
                    } else {
                        const firstTens = Math.floor(first / 10);
                        const firstOnes = first % 10;
                        const maxTens = 9 - firstTens;
                        const maxOnes = 9 - firstOnes;
                        const tens = Math.floor(Math.random() * maxTens) + 1;
                        const ones = Math.floor(Math.random() * (maxOnes + 1));
                        return tens * 10 + ones;
                    }
                }},
                { value: '2digit-carry', label: '2 digits - with carry (e.g., 28 + 47)', gen: () => Math.floor(Math.random() * 90) + 10 },
                { value: '3digit', label: '3 digits (e.g., 234 + 567)', gen: () => Math.floor(Math.random() * 900) + 100 },
                { value: 'large', label: 'Large numbers (e.g., 1234 + 5678)', gen: () => Math.floor(Math.random() * 9000) + 1000 }
            ],
            '-': [
                { value: '1digit', label: '1 digit (e.g., 8 ‚àí 3)', gen: () => Math.floor(Math.random() * 9) + 1 },
                { value: '2digit-simple', label: '2 digits - no borrow (e.g., 45 ‚àí 23)', gen: (first) => {
                    if (first === undefined) {
                        return Math.floor(Math.random() * 89) + 11; // 11-99 to ensure valid second number
                    } else {
                        const firstTens = Math.floor(first / 10);
                        const firstOnes = first % 10;
                        const maxTens = firstTens - 1; // strictly less than first tens
                        if (maxTens < 1) return Math.floor(Math.random() * (firstOnes + 1)); // single digit if first is 10-19
                        const tens = Math.floor(Math.random() * maxTens) + 1;
                        const ones = Math.floor(Math.random() * 10);
                        return tens * 10 + ones;
                    }
                }},
                { value: '2digit-borrow', label: '2 digits - with borrow (e.g., 52 ‚àí 28)', gen: () => Math.floor(Math.random() * 90) + 10 },
                { value: '3digit', label: '3 digits (e.g., 567 ‚àí 234)', gen: () => Math.floor(Math.random() * 900) + 100 },
                { value: 'large', label: 'Large numbers (e.g., 5678 ‚àí 1234)', gen: () => Math.floor(Math.random() * 9000) + 1000 }
            ],
            '*': [
                { value: 'single', label: 'Single digit (e.g., 3 √ó 7)', gen: () => Math.floor(Math.random() * 9) + 1 },
                { value: 'times-table', label: 'Times tables up to 12 (e.g., 8 √ó 12)', gen: () => Math.floor(Math.random() * 12) + 1 },
                { value: '1x2digit', label: '1 digit √ó 2 digits (e.g., 7 √ó 23)', gen: (isFirst) => isFirst ? Math.floor(Math.random() * 9) + 1 : Math.floor(Math.random() * 90) + 10 },
                { value: '2x2digit', label: '2 digits √ó 2 digits (e.g., 23 √ó 45)', gen: () => Math.floor(Math.random() * 90) + 10 },
                { value: 'large', label: 'Large numbers (e.g., 234 √ó 56)', gen: (isFirst) => isFirst ? Math.floor(Math.random() * 900) + 100 : Math.floor(Math.random() * 90) + 10 }
            ],
            '/': [
                { value: 'single', label: 'Single digit (e.g., 10 √∑ 3 = 3R1)', divisor: () => Math.floor(Math.random() * 9) + 1, dividend: () => Math.floor(Math.random() * 50) + 10 },
                { value: 'times-table', label: 'Times tables up to 12 (e.g., 75 √∑ 9 = 8R3)', divisor: () => Math.floor(Math.random() * 12) + 1, dividend: () => Math.floor(Math.random() * 100) + 10 },
                { value: '2digit', label: '2 digits √∑ 1 digit (e.g., 85 √∑ 7 = 12R1)', divisor: () => Math.floor(Math.random() * 9) + 1, dividend: () => Math.floor(Math.random() * 90) + 10 },
                { value: '3digit', label: '3 digits √∑ 1 digit (e.g., 456 √∑ 8 = 57)', divisor: () => Math.floor(Math.random() * 9) + 1, dividend: () => Math.floor(Math.random() * 900) + 100 },
                { value: '2x2digit', label: '2 digits √∑ 2 digits (e.g., 97 √∑ 12 = 8R1)', divisor: () => Math.floor(Math.random() * 90) + 10, dividend: () => Math.floor(Math.random() * 900) + 100 }
            ],
            'mixed': [
                { value: 'easy', label: 'Easy - 1 digit', gen: () => Math.floor(Math.random() * 9) + 1 },
                { value: 'medium', label: 'Medium - 2 digits', gen: () => Math.floor(Math.random() * 90) + 10 },
                { value: 'hard', label: 'Hard - 3 digits', gen: () => Math.floor(Math.random() * 900) + 100 }
            ]
        };

        function updateDifficulties() {
            operation = document.querySelector('input[name="operation"]:checked').value;
            const slider = document.getElementById('difficultySlider');
            slider.max = difficulties[operation].length - 1;
            slider.value = 0;
            updateDifficultyLabel();
        }

        function updateDifficultyLabel() {
            const slider = document.getElementById('difficultySlider');
            const index = parseInt(slider.value);
            const config = difficulties[operation][index];
            document.getElementById('difficultyLabel').textContent = config.label;
            difficulty = config.value;
        }

        function generateProblem() {
            const ops = operation === 'mixed' ? ['+', '-', '*', '/'] : [operation];
            const op = ops[Math.floor(Math.random() * ops.length)];
            
            let a, b, answer;
            
            if (op === '/') {
                // For mixed mode, use simple division
                if (operation === 'mixed') {
                    const config = difficulties[operation].find(d => d.value === difficulty);
                    b = Math.floor(Math.random() * 9) + 1;
                    a = config.gen();
                    const quotient = Math.floor(a / b);
                    const remainder = a % b;
                    answer = remainder === 0 ? quotient.toString() : `${quotient}R${remainder}`;
                } else {
                    const config = difficulties[op].find(d => d.value === difficulty);
                    b = config.divisor();
                    a = config.dividend();
                    const quotient = Math.floor(a / b);
                    const remainder = a % b;
                    answer = remainder === 0 ? quotient.toString() : `${quotient}R${remainder}`;
                }
            } else {
                const config = difficulties[operation === 'mixed' ? operation : op].find(d => d.value === difficulty);
                
                if (operation !== 'mixed' && op === '*' && (difficulty === '1x2digit' || difficulty === 'large')) {
                    a = config.gen(true);
                    b = config.gen(false);
                } else if (operation !== 'mixed' && (op === '+' || op === '-') && difficulty === '2digit-simple') {
                    a = config.gen();
                    b = config.gen(a);
                } else {
                    a = config.gen();
                    b = config.gen();
                    if (op === '-' && a < b) [a, b] = [b, a];
                }
                
                if (op === '+') answer = (a + b).toString();
                else if (op === '-') answer = (a - b).toString();
                else if (op === '*') answer = (a * b).toString();
            }
            
            const symbol = op === '*' ? '√ó' : op === '/' ? '√∑' : op;
            const isVertical = Math.random() < 0.5;
            return { a, b, op, symbol, answer, display: `${a} ${symbol} ${b}`, isVertical };
        }

        function startPractice() {
            operation = document.querySelector('input[name="operation"]:checked').value;
            const index = parseInt(document.getElementById('difficultySlider').value);
            difficulty = difficulties[operation][index].value;
            correct = 0;
            total = 0;
            wrongList = [];
            
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('practice').classList.remove('hidden');
            updateStats();
            nextProblem();
        }

        function nextProblem() {
            currentProblem = generateProblem();
            const display = document.getElementById('problemDisplay');
            
            if (currentProblem.isVertical) {
                if (currentProblem.op === '/') {
                    const aStr = currentProblem.a.toString();
                    const bStr = currentProblem.b.toString();
                    const totalWidth = bStr.length + 2 + aStr.length; // "b )a"
                    const line = '_'.repeat(aStr.length + 1).padStart(totalWidth, ' ');
                    const divLine = `${bStr} )${aStr}`;
                    display.innerHTML = `<div class="vertical-problem">${line}\n${divLine}</div>`;
                } else {
                    const aStr = currentProblem.a.toString();
                    const bStr = currentProblem.b.toString();
                    const maxLen = Math.max(aStr.length, bStr.length);
                    const totalWidth = maxLen + 2; // space for operator + space
                    const line1 = aStr.padStart(totalWidth, ' ');
                    const line2 = `${currentProblem.symbol} ${bStr.padStart(maxLen, ' ')}`;
                    const line3 = '‚îÄ'.repeat(totalWidth);
                    display.innerHTML = `<div class="vertical-problem">${line1}\n${line2}\n${line3}</div>`;
                }
            } else {
                display.textContent = currentProblem.display;
            }
            
            const inputField = document.getElementById('userInput');
            inputField.value = '';
            inputField.disabled = false;
            inputField.placeholder = currentProblem.op === '/' ? '? (use R for remainder, e.g., 4R3)' : '?';
            document.getElementById('submitBtn').disabled = false;
            inputField.focus();
        }

        function updateStats() {
            const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('totalStat').textContent = total;
            document.getElementById('correctStat').textContent = correct;
            document.getElementById('wrongStat').textContent = total - correct;
            document.getElementById('accuracyStat').textContent = accuracy + '%';
        }

        function checkAnswer() {
            const inputField = document.getElementById('userInput');
            const submitBtn = document.getElementById('submitBtn');
            
            if (inputField.disabled || submitBtn.disabled) return;
            
            const userAnswer = inputField.value.trim().toUpperCase();
            if (!userAnswer) return;
            
            inputField.disabled = true;
            submitBtn.disabled = true;
            
            total++;
            const isCorrect = userAnswer === currentProblem.answer.toUpperCase();
            
            if (isCorrect) {
                correct++;
                document.getElementById('problemDisplay').innerHTML = 
                    `<div style="font-size: 48px;">üêπ</div>
                     <div style="color: #48bb78; font-size: 24px; margin-top: 10px;">‚úì ${currentProblem.display} = ${currentProblem.answer}</div>`;
            } else {
                wrongList.push({
                    problem: currentProblem.display,
                    correct: currentProblem.answer,
                    userAnswer: userAnswer
                });
                document.getElementById('problemDisplay').innerHTML = 
                    `<div style="font-size: 48px;">üêä</div>
                     <div style="color: #e53e3e; font-size: 24px; margin-top: 10px;">‚úó ${currentProblem.display} = ${currentProblem.answer}</div>`;
            }
            
            updateStats();
            setTimeout(nextProblem, 1500);
        }

        function handleEnter(event) {
            if (event.key === 'Enter') checkAnswer();
        }

        function stopPractice() {
            if (total > 0) {
                saveSession();
            }
            
            document.getElementById('practice').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
            
            const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('finalTotal').textContent = total;
            document.getElementById('finalCorrect').textContent = correct;
            document.getElementById('finalWrong').textContent = total - correct;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            
            if (wrongList.length > 0) {
                document.getElementById('wrongAnswers').innerHTML = wrongList.map(item => 
                    `<div class="result-item">
                        <strong>${item.problem} = ${item.correct}</strong>
                        <div class="user-answer">Your answer: ${item.userAnswer}</div>
                    </div>`
                ).join('');
            } else {
                document.getElementById('wrongAnswers').innerHTML = 
                    '<div class="perfect">üéâ Perfect score! No mistakes!</div>';
            }
            
            showHistoryStats();
        }

        function showHistoryStats() {
            const historyDiv = document.getElementById('historyStats');
            if (sessionHistory.length === 0) {
                historyDiv.innerHTML = '';
                return;
            }
            
            const totalSessions = sessionHistory.length;
            const totalProblems = sessionHistory.reduce((sum, s) => sum + s.total, 0);
            const totalCorrect = sessionHistory.reduce((sum, s) => sum + s.correct, 0);
            const avgAccuracy = totalProblems > 0 ? Math.round((totalCorrect / totalProblems) * 100) : 0;
            
            const last10 = sessionHistory.slice(-10);
            const width = 500;
            const height = 150;
            const padding = 20;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            const maxProblems = Math.max(...last10.map(s => s.total), 1);
            
            const accuracyPoints = last10.length === 1 
                ? `${padding},${height - padding - (last10[0].accuracy / 100) * chartHeight} ${width - padding},${height - padding - (last10[0].accuracy / 100) * chartHeight}`
                : last10.map((s, i) => {
                    const x = padding + (i / (last10.length - 1)) * chartWidth;
                    const y = height - padding - (s.accuracy / 100) * chartHeight;
                    return `${x},${y}`;
                }).join(' ');
            
            const problemPoints = last10.length === 1
                ? `${padding},${height - padding - (last10[0].total / maxProblems) * chartHeight} ${width - padding},${height - padding - (last10[0].total / maxProblems) * chartHeight}`
                : last10.map((s, i) => {
                    const x = padding + (i / (last10.length - 1)) * chartWidth;
                    const y = height - padding - (s.total / maxProblems) * chartHeight;
                    return `${x},${y}`;
                }).join(' ');
            
            const circles = last10.map((s, i) => {
                const x = last10.length === 1 ? width / 2 : padding + (i / (last10.length - 1)) * chartWidth;
                const yAcc = height - padding - (s.accuracy / 100) * chartHeight;
                const yProb = height - padding - (s.total / maxProblems) * chartHeight;
                return `<circle cx="${x}" cy="${yAcc}" r="4" fill="#f5576c"/>
                        <text x="${x}" y="${yAcc - 10}" text-anchor="middle" font-size="12" fill="#f5576c">${s.accuracy}%</text>
                        <circle cx="${x}" cy="${yProb}" r="4" fill="#48bb78"/>
                        <text x="${x}" y="${yProb - 10}" text-anchor="middle" font-size="12" fill="#48bb78">${s.total}</text>`;
            }).join('');
            
            const labels = last10.map(s => {
                const date = new Date(s.date);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const timeStr = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                return `<span>${dateStr}<br>${timeStr}</span>`;
            }).join('');
            
            historyDiv.innerHTML = `
                <div class="history-section">
                    <h3 style="margin-bottom: 15px;">üìà All-Time Statistics</h3>
                    <div class="history-stats">
                        <div class="stat-card">
                            <div class="stat-value">${totalSessions}</div>
                            <div class="stat-label">Sessions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${totalProblems}</div>
                            <div class="stat-label">Total Problems</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${avgAccuracy}%</div>
                            <div class="stat-label">Avg Accuracy</div>
                        </div>
                    </div>
                    <div class="graph">
                        <h4 style="margin-bottom: 10px; color: #2d3748;">Recent Sessions (Last ${last10.length})</h4>
                        <div style="margin-bottom: 10px;">
                            <span style="color: #f5576c; margin-right: 15px;">‚óè Accuracy %</span>
                            <span style="color: #48bb78;">‚óè Problem Count</span>
                        </div>
                        <div class="line-chart">
                            <svg class="chart-svg" viewBox="0 0 ${width} ${height}">
                                <line x1="${padding}" y1="${height - padding}" x2="${width - padding}" y2="${height - padding}" stroke="#e2e8f0" stroke-width="2"/>
                                <line x1="${padding}" y1="${padding}" x2="${padding}" y2="${height - padding}" stroke="#e2e8f0" stroke-width="2"/>
                                <polyline points="${accuracyPoints}" fill="none" stroke="#f5576c" stroke-width="3"/>
                                <polyline points="${problemPoints}" fill="none" stroke="#48bb78" stroke-width="3"/>
                                ${circles}
                            </svg>
                            <div class="chart-labels">${labels}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function restart() {
            document.getElementById('results').classList.add('hidden');
            document.getElementById('setup').classList.remove('hidden');
        }

        window.onload = () => {
            loadHistory();
            updateDifficulties();
        };
    </script>
</body>
</html>
